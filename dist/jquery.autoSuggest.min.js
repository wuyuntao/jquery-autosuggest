/*! jQuery AutoSuggest - v2.0.0 - 2012-07-08
* http://hlsolutions.github.com/jquery-autosuggest
* Copyright (c) 2012 Jan Philipp; Licensed MIT, GPL */
(function(){var a,b,c={}.hasOwnProperty;a=jQuery,b=function(){function b(a,b){this.hiddenField=a,this.items=b!=null?b:[]}return b.prototype.hiddenField=null,b.prototype.items=null,b.prototype.syncToHiddenField=function(){var a,b,c,d,e;b="",e=this.items;for(c=0,d=e.length;c<d;c++)a=e[c],b+=","+a;b&&(b+=","),this.hiddenField.val(b||",")},b.prototype.add=function(a){this.exist(a)||this.items.push(a),this.syncToHiddenField()},b.prototype.remove=function(b){this.items=a.grep(this.items,function(a){return a!==b}),this.syncToHiddenField()},b.prototype.isEmpty=function(){return this.items.length===0},b.prototype.exist=function(b){return a.inArray(b,this.items)!==-1},b.prototype.getAll=function(){return this.items.slice(0)},b.prototype.clear=function(){this.items=[],this.syncToHiddenField()},b}(),a.fn.autoSuggest=function(d,e){var f,g,h,i,j,k,l;g={asHtmlID:!1,startText:"Enter Name Here",usePlaceholder:!1,emptyText:"No Results Found",preFill:{},limitText:"No More Selections Are Allowed",selectedItemProp:"value",selectedValuesProp:"value",searchObjProps:"value",queryParam:"q",limitParam:"limit",retrieveLimit:null,extraParams:null,matchCase:!1,minChars:1,keyDelay:400,resultsHighlight:!0,neverSubmit:!1,selectionLimit:!1,showResultList:!0,showResultListWhenNoMatch:!1,canGenerateNewSelections:!0,start:function(){},selectionClick:function(a){},selectionAdded:function(a){},selectionRemoved:function(a){return a.remove()},formatList:null,beforeRetrieve:function(a){return a},retrieveComplete:function(a){return a},resultClick:function(a){},resultsComplete:function(){},preventPropagationOnEscape:!1,ajaxOptions:{type:"get",dataType:"json"}},e=a.extend({},g,e),f=function(a){var b;return function(){var d;d=[];for(b in a){if(!c.call(a,b))continue;d.push(b)}return d}().length},k=function(){var b,c,d,f,g,h,i;f=e.extraParams,a.isFunction(f)&&(f=f(this));if(a.type(f)==="string"){b={},i=f.split("&");for(g=0,h=i.length;g<h;g++){c=i[g];if(c==="")continue;d=c.split("=",2),d.length&&(b[d[0]]=d[1])}f=b}return f},h=function(b){return a("<span/>").text(b).html()},i=function(a){if(a)return a.replace(/"/g,'\\"')},l=null,j=function(){switch(a.type(d)){case"function":return d;case"string":return function(b,c){var f,g,h;return h={},h[""+e.queryParam]=encodeURIComponent(decodeURIComponent(b)),e.retrieveLimit&&(h[e.limitParam]=encodeURIComponent(e.retrieveLimit)),g=k(),a.type(g)==="object"&&a.extend(h,g),f=a.extend({},e.ajaxOptions,{url:d,data:h}),l=a.ajax(f).done(function(a){return c(e.retrieveComplete.call(this,a),b)})};case"array":case"object":return function(a,b){return b(d,a)}}}();if(!j)return;return this.each(function(c){var d,f,g,k,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O;e.asHtmlID?(c=e.asHtmlID,k=c):(c=""+c+Math.floor(Math.random()*100),k="as-input-"+c),n=a(this),n.attr({autocomplete:"off",id:k}),n.addClass("as-input"),e.usePlaceholder?n.attr({placeholder:e.startText}):n.val(e.startText),g=function(b,f){var g,j;return d.add(b[e.selectedValuesProp]),j=a('<li class="as-selection-item" id="as-selection-'+f+'" data-value="'+i(h(b[e.selectedValuesProp]))+'"></li>'),j.click(function(){c=a(this),e.selectionClick.call(this,c),D.children().removeClass("selected"),c.addClass("selected")}),j.mousedown(function(){var a;a=!1}),g=a('<a class="as-close">&times;</a>'),g.click(function(){var a;return d.remove(b[e.selectedValuesProp]),e.selectionRemoved.call(this,j),a=!0,n.focus(),!1}),typeof b[e.selectedItemProp]!="string"?w.before(j.append(b[e.selectedItemProp]).prepend(g)):w.before(j.text(b[e.selectedItemProp]).prepend(g)),e.selectionAdded.call(this,w.prev(),b[e.selectedValuesProp]),w.prev()},o=!1,n.wrap('<ul class="as-selections" id="as-selections-'+c+'"></ul>').wrap('<li class="as-original" id="as-original-'+c+'"></li>'),D=a("#as-selections-"+c),w=a("#as-original-"+c),B=a('<div class="as-results" id="as-results-'+c+'"></div>'),C=a('<ul class="as-list"></ul>'),I=a('<input type="hidden" class="as-values" name="as_values_'+c+'" id="as-values-'+c+'" />'),e.start.call(this,{add:function(b){var c,d;return c=a(D).find("li").length,d=g(b,"u"+c),d!=null?d.addClass("blur"):void 0},remove:function(a){return d.remove(a),D.find('li[data-value="'+h(a)+'"]').remove()}}),d=new b(I),x="";switch(a.type(e.preFill)){case"string":N=e.preFill.split(",");for(J=0,L=N.length;J<L;J++)H=N[J],q={},q[""+e.selectedValuesProp]=H,H!==""&&g(q,"000"+m);x=e.preFill;break;case"array":x="";if(e.preFill.length){O=e.preFill;for(m=K=0,M=O.length;K<M;m=++K)q=O[m],u=q[e.selectedValuesProp],typeof u=="undefined"&&(u=""),x+=u+",",u!==""&&g(q,"000"+m)}}return x!==""&&(n.val(""),D.find("li.as-selection-item").addClass("blur").removeClass("selected")),n.after(I),D.click(function(){o=!0,n.focus()}),D.mousedown(function(){o=!1}),D.after(B),p=null,F=null,y="",G=0,E=!1,s=null,v=0,r=function(){var a;a=n.val().replace(/[\\]+|[\/]+/g,"");if(a===y)return;return y=a,a.length>=e.minChars?(D.addClass("loading"),A(a)):(D.removeClass("loading"),B.hide())},A=function(b){if(a.isFunction(e.beforeRetrieve))return b=e.beforeRetrieve.call(this,b),f(),j(b,z)},z=function(b,f){var i,j,k,l,m,p,r,s,t,u,w,x,z;e.matchCase||(f=f.toLowerCase()),f=f.replace("(","(","g").replace(")",")","g"),k=0,B.hide().html(C.html("")),m=0;for(t=0,w=b.length;t<w;t++){q=b[t],v++,j=!1;if(e.searchObjProps==="value")r=q.value;else{r="",z=e.searchObjProps.split(",");for(u=0,x=z.length;u<x;u++)l=z[u],r+=""+q[a.trim(l)]+" "}r&&(e.matchCase||(r=r.toLowerCase()),r.search(f)!==-1&&!d.exist(q[e.selectedValuesProp])&&(j=!0));if(j){i=a('<li class="as-result-item" id="as-result-item-'+m+'"></li>'),i.click(function(){var d,f;c=a(this),f=c.data("data"),d=f.num,D.find("#as-selection-"+d).length<=0&&!E&&(b=f.attributes,n.val("").focus(),y="",g(b,d),e.resultClick.call(this,f),B.hide()),E=!1}),i.mousedown(function(){o=!1}),i.mouseover(function(){c=a(this),C.find("li").removeClass("active"),c.addClass("active")}),i.data("data",{attributes:b[m],num:v}),s=a.extend({},b[m]),f=f.replace(/"/g,'\\"'),p=e.matchCase?new RegExp("(?![^&;]+;)(?!<[^<>]*)("+h(f)+")(?![^<>]*>)(?![^&;]+;)","g"):new RegExp("(?![^&;]+;)(?!<[^<>]*)("+h(f)+")(?![^<>]*>)(?![^&;]+;)","gi"),typeof s[e.selectedItemProp]=="string"?(s[e.selectedItemProp]=h(s[e.selectedItemProp]),e.resultsHighlight&&f.length>0&&(s[e.selectedItemProp]=s[e.selectedItemProp].replace(p,"<em>$1</em>"))):s[e.selectedItemProp].html(s[e.selectedItemProp].html().replace(p,"<em>$1</em>")),e.formatList?i=e.formatList.call(this,s,i):i=i.html(s[e.selectedItemProp]),C.append(i),s=null,k++;if(e.retrieveLimit&&e.retrieveLimit===k)break}m+=1}return D.removeClass("loading"),k<=0&&C.html('<li class="as-message">'+e.emptyText+"</li>"),C.css({width:D.outerWidth()}),(k>0||!e.showResultListWhenNoMatch)&&B.show(),e.resultsComplete.call(this)},t=function(a){var b,c,d;if(B.find(":visible").length){c=B.find("li");switch(a){case"down":d=c.eq(0);break;default:d=c.filter(":last")}b=B.find("li.active:first");if(b.length)switch(a){case"down":d=b.next();break;default:d=b.prev()}return c.removeClass("active"),d.addClass("active")}},f=function(){if(!l)return;return l.abort(),l=null},n.focus(function(){return c=a(this),!e.usePlaceholder&&c.val()===e.startText&&d.isEmpty()?c.val(""):o&&(D.find("li.as-selections-item").removeClass("blur"),c.val()!==""&&(C.css({width:D.outerWidth()}),B.show())),p&&clearInterval(p),p=setInterval(function(){e.showResultList&&(e.selectionLimit&&D.find("li.as-selection-item").length>=e.selectionLimit?(C.html('<li class="as-message">'+e.limitText+"</li>"),B.show()):r())},e.keyDelay),o=!0,e.minChars===0&&A(c.val()),!0}),n.blur(function(){c=a(this),!e.usePlaceholder&&c.val()===""&&d.isEmpty()&&x===""&&e.minChars>0?c.val(e.startText):o&&(D.find("li.as-selection-item").addClass("blur").removeClass("selected"),B.hide()),p&&clearInterval(p)}),n.keydown(function(a){var b,c,h,i,j;s=a.keyCode,c=!1;switch(a.keyCode){case 38:a.preventDefault(),t("up");break;case 40:a.preventDefault(),t("down");break;case 8:n.val()===""&&(i=d.getAll(),i.length?i=i[i.length-1]:i=null,D.children().not(w.prev()).removeClass("selected"),w.prev().hasClass("selected")?(d.remove(i),e.selectionRemoved.call(this,w.prev())):(e.selectionClick.call(this,w.prev()),w.prev().addClass("selected"))),n.val().length===1&&(B.hide(),y="",f()),B.find(":visible").length&&(F&&clearTimeout(F),F=setTimeout(function(){r()},e.keyDelay));break;case 9:case 188:e.canGenerateNewSelections&&(E=!0,h=n.val().replace(/(,)/g,""),b=B.find("li.active:first"),h!==""&&!d.exist(h)&&h.length>=e.minChars&&b.length===0&&(a.preventDefault(),j={},j[""+e.selectedItemProp]=h,j[""+e.selectedValuesProp]=h,g(j,"00"+(D.find("li").length+1)),n.val(""),f()));break;case 13:E=!1,b=B.find("li.active:first"),b.length&&(b.click(),B.hide()),(e.neverSubmit||b.length)&&a.preventDefault();break;case 27:e.preventPropagationOnEscape&&B.find(":visible").length&&a.stopPropagation();break;case 16:case 20:f(),B.hide()}})})}}).call(this);